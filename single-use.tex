\section{Single-use sets and functions}
\label{sec:single-use-sets}
We now turn to our first solution for the problem of orbit-finite function spaces.  Our solution builds on the idea from~\cite[Section 2.2]{stefanski-phd}, which is to consider only functions that are single-use. We describe this idea in Section~\ref{sec:single-use-functions-over-polynomial-orbit-finite-sets}, and we show how it almost, but not quite, achieves function spaces. Then, in the rest of this section, we show how function spaces can be recovered by using a more refined type system. 

\subsection{Single-use functions over polynomial orbit-finite sets}
\label{sec:single-use-functions-over-polynomial-orbit-finite-sets}

In the introduction, we have already given an intuitive description behind the single-use functions; these are functions that destroy the argument after any use of it, such as comparing it to a constant. We now give a more formal definition.

We do not define the single-use functions on all orbit-finite sets, but only a syntactically defined fragment, namely the \emph{polynomial orbit-finite sets}, which are sets that can be generated from $1$ and $\atoms$ using  
 products $\times$ and disjoint unions $+$. Therefore, we will allow orbit-finite sets like $1 + \atoms^2$, but we will not allow orbit-finite sets like 
the set of non-repeating pairs
$\setbuild{(a,b)}{$a \neq b \in \atoms$}$ or the set of unordered pairs $\setbuild{\set{a,b}}{$a \neq b \in \atoms$}$. It is an open problem to find a satisfactory definition of single-use functions on all orbit-finite sets. A simple hack is to use a quotienting construction, similar to Section~\ref{sec:quotient-category}, but what we would really like to do is to identify some extra structure in a set, possibly an action of some yet unknown group or semigroup, which enables us to speak about single-use functions.

Consider two polynomial orbit-finite sets $X$ and $Y$. To define which functions $X \to Y$ are single-use, we use an inductive definition. We begin with certain functions that are considered single-use, such as the equality test of type $\atoms \times \atoms \to 1 + 1$. These functions are called the \emph{prime functions}, and their full list is given in Figure~\ref{fig:prime-morphisms-without-with}. Next, we combine the prime functions into new ones using three combinators. The first, and most important, combinator is  function composition. Then, we have two combinators for the two type constructors: if two functions $f_1 : X_1 \to Y_1$ and $f_2 : X_2 \to Y_2$ are single-use, then the same is true for:
\begin{align*}
    f_1 \times f_2 : X_1 \times X_2 \to Y_1 \times Y_2
    \qquad &
    f_1 + f_2 : X_1 + X_2 \to Y_1 + Y_2 \\
    \scriptstyle  (x_1,x_2) \mapsto (f_1(x_1),f_2(x_2)) 
    \qquad &
    {\scriptstyle \text{left}(x_1) \mapsto \text{left}(f_1(x_1)) 
        \quad 
        \text{right}(x_2) \mapsto \text{right}(f_2(x_2)) }.
\end{align*}

Crucially, the list of prime single-use function does not contain the copying function $a \in \atoms \mapsto (a,a) \in \atoms^2$. Therefore, an alternative name for the single-use functions is \emph{copyless}. If we added copying, then we would get all finitely supported functions~\cite[Lemma 23]{stefanski-phd}.

\begin{table}[h!]
    \centering
    \begin{tabular}{lll}
        \textbf{Function} & \textbf{Type} & \textbf{Definition} \\ \\
        \emph{Functions about $\atoms$} \\
        equality test & $\atoms \times \atoms \to 1 + 1$ & $a, b \mapsto \text{if } a = b \text{ then true else false}$ \\
        constant $a$ & $1 \to \atoms$ & $x \mapsto a$ \\
        identity & $\atoms \to \atoms$ & $x \mapsto x$ \\
        \\
        \emph{Functions about \(\times\)} \\
        commutativity of $\times$ & $X \times Y \to Y \times X$ & $x \times y \mapsto y \times x$ \\
        first projection & $X \times Y \to X$ & $x \times y \mapsto x$ \\
        second projection & $X \times Y \to Y$ & $x \times y \mapsto y$ \\
        append 1 & $X \to X \times 1$ & $x \mapsto x \times ()$ \\
        associativity of $\times$ & $(X \times Y) \times Z \to X \times (Y \times Z)$ & $(x \times y) \times z \mapsto x \times (y \times z)$ \\ \\
        \emph{Functions about \(+\)} \\
        first co-projection & $X \to X + Y$ & $x \mapsto \text{left}(x)$ \\
        second co-projection & $Y \to X + Y$ & $y \mapsto \text{right}(y)$ \\
        co-diagonal & $X + X \to X$ & $\left\{\begin{tabular}{l}
            $\text{left}(x) \mapsto x$\\
            $\text{right}(x) \mapsto x$
            \end{tabular}\right.$ \\
        commutativity of $+$ & $X + Y \to Y + X$ & $\left\{\begin{tabular}{l}
        $\textrm{left}(x) \mapsto \textrm{right}(x)$\\
        $\textrm{right}(y) \mapsto \textrm{left}(y)$
        \end{tabular}\right.$ \\
        associativity of $+$ & $(X + Y) + Z \to X + (Y + Z)$ & $\left\{
        \begin{tabular}{l}
        $\text{left}(\text{left}(x)) \mapsto \text{left}(x)$\\
        $\text{left}(\text{right}(y)) \mapsto \text{right}(\text{left}(y))$\\
        $\text{right}(z)\mapsto \text{right}(\text{right}(z))$
        \end{tabular}\right.$ \\
        \\
        \emph{Distributivity}
        \\
        $+$ distributes over $\times$ & $X \times (Y + Z) \to (X \times Y) + (X \times Z)$ & $\left\{\begin{tabular}{l}
            $x \times (\text{left}(y)) \mapsto \text{left}(x \times y)$\\
            $x \times (\text{right}(z)) \mapsto \text{right}(x \times z)$
        \end{tabular}\right.$ \\
        \\
    \end{tabular}
    \caption{The prime single-use functions for polynomial orbit-finite sets $X, Y$ and $Z$.}
    \label{fig:prime-morphisms-without-with}
\end{table}





\begin{example}\label{ex:six-compositions}
    Consider function of type $\atoms^3 \to \atoms$ which inputs a triple $(a,b,c)$ of atoms and returns $a$ if $c$ is equal to Mark, and $b$ otherwise. This function is a single-use function. It is obtained by composing the six functions listed below:
\begin{center}
    \begin{tabular}{ll}
        Function & Type after function \\
        \hline
        Append 1. & $ \atoms \times \atoms \times \atoms \times 1$ \\
        Replace added $1$ with Mark using the constant function. & $\atoms \times \atoms \times \atoms \times \atoms$ \\
        Apply the equality test to the last two components. & $ \atoms \times \atoms \times (1+1)$ \\
        Distribute. & $ \atoms \times \atoms \times 1 +   \atoms \times \atoms \times 1$ \\
        Project to first and second components, respectively. & $\atoms + \atoms$ \\
        Co-diagonal & $\atoms$ 
    \end{tabular}
\end{center}
To justify this description, one should also show that the six functions are single-use. Three of the functions, namely append 1, distributivity and co-diagonal are prime functions. The other three are obtained by combining prime functions using the combinators. For example, the equality test is paired, using the combinator for $\times$, with the identity on the remaining two atoms. 
\end{example}

The design goal of the single-use restriction is to have orbit-finite function spaces. The rough idea is that a single-use function can only use a bounded number of atoms in its source code, which guarantees orbit-finiteness of the function space. 

\begin{example}\label{ex:first-single-use-function-space}
    Consider function of type $\atoms \to 1 + 1$, which can be seen as subsets of the atoms, with $1+1$ representing the Booleans. We will consider two function spaces: the larger space of all finitely supported functions, and the smaller space of the single-use function.
    
    A function in the larger space is any finitely supported subset of the atoms; such subsets are the same as the finite and co-finite subsets. Therefore, the larger function space admits an equivariant bijection with a disjoint union of two copies of the finite powerset $\powerset_{\text{fin}} \atoms$, in particular it is not orbit-finite.
    
    Consider now the smaller single-use function space. There are four possible functions of this kind: (a) always return true; (b) always return false; (c) check for equality with some fixed atom $a$; (d) check for disequality with with some fixed atom $a$.  Therefore,  the set of single-use functions  admits an equivariant bijection with the orbit-finite set $1 + 1 + \atoms + \atoms$.
    \exampleend

\end{example}


The above example shows that the space of single-use functions of a some type $X \to Y$ is orbit-finite, and in fact it can be described using a polynomial orbit-finite set. This is true for every choice of polynomial orbit-finite sets $X$ and $Y$, as proved in~\cite[Theorem 5]{stefanski-phd}. Let us give a brief explanation of why this is true. Using distributivity one reduce the problem of finding function spaces to the case when the input is some power of the atoms $X = \atoms^k$, and the output is disjoint union of powers of the atoms $Y = \atoms^{n_1} + \cdots + \atoms^{n_\ell}$. 

In some case, the same function is represented in several different ways. For example, the two function of type $\atoms^2 \to 1 + 1$ that returns true if the input pair is (Mark, John) and false otherwise can be represented by two programs, which do the comparisons in the different orders. 

\paragraph*{Problem with currying}
Unfortunately, the proposal from~\cite{stefanski-phd} does not constitute a satisfactory solution to the problem of function spaces. Suppose that we have polynomial orbit-finite sets $X$ and $Y$, and we have some new polynomial orbit-finite set, call it $X \Rightarrow Y$, which represents the single-use functions from $X$ to $Y$. We would like this set to not only exist, but it should also support operations on functions, such as: 
\begin{enumerate}
    \item evaluation: a single-use function from $(X \Rightarrow Y) \times X$ to $Y$ which inputs a representation of a function and applies it to an argument;
    \item composition: a function from $(X \Rightarrow Y) \times (Y \Rightarrow Z)$ to $(X \Rightarrow Z)$ which inputs the representations of two functions and returns a representation of their composition.
    \item currying: for each single-use function from  $ X \times Y $ to $Z$, there should be a single-use function from $X$ to $Y \Rightarrow Z$ which inputs a first argument and returns a representation of the  partially applied function;
\end{enumerate}
Only in the presence of all of these operations can we speak of a function space, and the corresponding category can be called closed. (Composition can be obtained through evaluation and currying, so the essential operations are evaluation and currying.) The following example shows that the currying operation is not single-use, and therefore the space of single-use functions as defined in this section is not closed. 


\begin{example}
    Consider  the single-use function
    \begin{align*}
    f : \atoms \times \atoms \to 1 + 1 \qquad (a,b)  
    \mapsto \begin{cases}
        \text{result of test $a = $ Mark} & \text{if } b = \text{Eve} \\
        \text{result of test $a = $ John} & \text{otherwise}.
        \end{cases}
    \end{align*}
The currying of this function, is a new function which  maps a first argument $a \in \atoms$ to the partially applied function $f(a,\_)$. This currying is
\begin{align*}
    a \mapsto \begin{cases}
        b \mapsto b = \text{Eve} & \text{if } a = \text{Mark} \\
        b \mapsto b \neq \text{Eve} & \text{if } a = \text{John} \\
        b \mapsto \text{false} & \text{otherwise}
        \end{cases}
\end{align*}
Recall that in Example~\ref{ex:first-single-use-function-space} we showed that the space of single-use functions of type $\atoms \to 1 + 1$ can be represented as $1 + 1 + \atoms + \atoms$. If we use this representation,  then the currying of the function $f$  is not single-use, because we need to compare the input atom $a$ to two constants, Mark and John. 
\end{example}

Another problem with the single-use functions as described in this section is that although they are closed under composition, the operation that inputs two representations of single-use functions and outputs a composition of their representation is also not single-use. This problem means that we cannot convert automata into single-use monoids, as we would like to do, since the resulting monoid would need to use function composition as its monoid operation. (This problem is solved in~\cite{bojanczykstefanski2020} and~\cite{stefanski-phd} in a different way, namely there is a )

To solve the issue from the above example, we will  extend the category using a more refined type system, in which we distinguish two different kinds of products, called $\&$ and $\otimes$, as in linear logic. For the  benefit of the impatient reader,   the appropriate type for the function space $\atoms \Rightarrow 1+1$ will turn out to be 
\begin{align*}
1 + 1 + \atoms \otimes ((1+1) \& (1+1)).
\end{align*}

\subsection{The types}
As mentioned above, to solve the problems with single-use function spaces, we will consider a type system with two kinds of products, as in the following definitoin.
\begin{definition}[Linear types]\label{def:datatypes}
    A \emph{linear type} is any expression constructed from the atomic types $1$ and $\atoms$ using the binary type constructors $+, \&$ and $\otimes$. 
\end{definition}
In our linear types, it is only the products that are differentiated, while  $+$ comes in only one version\footnote{Thinking of $\otimes$ and $\&$ as being related is perhaps not entirely orthodox for linear logic, where $\&$ corresponds via duality to $+$. In linear logic, there is also a type constructor $\rotatebox[origin=c]{180}{\&}$ that is dual to $\otimes$, but we do not use it here.}.
    Here is the intuitive explanation of the difference between the two kinds of products, following Girard~\cite[p.2]{girard1995advances}. Having a pair $x \otimes y$ is like having the ability of using both components $x$ and $y$. On the other hand, having a pair $x \& y$ is like having the ability to use one of the two components, at our choice, but not both at once. For example, the input type of the equality test will be $\atoms \otimes \atoms$ and $\atoms \& \atoms$, since the test will need to consume both arguments. This intuition can only go so far; for example it is not entirely clear what ``our choice'' means. We will revisit this intuition in Section~\ref{sec:game-semantics}, where game semantics will be used to indicate who makes which choices. 



We think of each linear type $X$ as representing an orbit-finite set $\sem X$, as defined below:
\begin{align*}
    \sem{1} = 1
\quad 
\sem{\atoms} = \atoms 
\quad 
\sem{X+Y} = \sem X + \sem Y 
\quad 
\sem{X \otimes Y} = \sem X \times \sem Y 
\quad
\sem{X \& Y} = \sem X \times \sem Y.
\end{align*}
Note that the two kinds of product represent the same set.
However, the two type constructors will be  different, because different functions will be allowed to operate on them. As the expression goes, ``the proof of the pudding is in the eating''; in this case the pudding is the types and the eating is the functions.  



\subsection{Single-use functions}
\label{sec:single-use-functions}

For linear types $X$ and $Y$, the single-use functions of type $X \to Y$  will be defined as a certain subset of the finitely supported functions of type $\sem X \to \sem Y$. As in~\cite{stefanski-phd}, we define this subset  in terms of certain prime and combinators. Two alternative approaches would be: $\lambda$-calculus (we do not pursue this direction) or game semantics (see Section~\ref{sec:game-semantics}).

For the prime functions, we use some standard single-use operations known from linear logic, which are listed in Figure~\ref{fig:prime-morphisms}, and include operations such as projection or various kinds of distributivity. On top of that, to handle the atoms,  we allow an equality test of type $\atoms \otimes \atoms \to 1 + 1$, which tells us if the two input atoms are equal, and for every atom $a \in \atoms$ we have a constant function of type $1 \to \atoms$.
% \begin{align}\label{eq:eq-test}
% \text{eq} : \sem{\atoms \otimes \atoms} \to \sem{1+1},
% \end{align}
% which returns the left copy of $1$ for equal inputs and the right copy for non-equal inputs,
% and a constant function
% \begin{align}\label{eq:const-functions}
% \text{const}_a : \sem 1 \to \sem \atoms
% \end{align}
% for every atom $a \in \atoms$.

\begin{table}[h!]
    \centering
    \begin{tabular}{lll}
        \hline
        \textbf{Function} & \textbf{Type} & \textbf{Definition} \\
        \hline
        \multicolumn{3}{c}{\textit{Functions about $\atoms$}} \\
        \hline
        $\textrm{eq}$ & $\atoms \otimes \atoms \to 1 + 1$ & $a, b \mapsto \text{if } a = b \text{ then true else false}$ \\
        $\textrm{const}_a$ & $1 \to \atoms$ & $x \mapsto a$ \\
        $\textrm{id}$ & $\atoms \to \atoms$ & $x \mapsto x$ \\
        \hline
        \multicolumn{3}{c}{\textit{Functions about \(\otimes\)}} \\
        \hline
        $\textrm{swap}_{\otimes}$ & $X \otimes Y \to Y \otimes X$ & $x \otimes y \mapsto y \otimes x$ \\
        $\textrm{proj}_{1, \otimes}$ & $X \otimes Y \to X$ & $x \otimes y \mapsto x$ \\
        $\textrm{proj}_{2, \otimes}$ & $X \otimes Y \to Y$ & $x \otimes y \mapsto y$ \\
        $\textrm{rightI}_{\otimes}$ & $X \to X \otimes 1$ & $x \mapsto x \otimes ()$ \\
        $\textrm{assoc}_{\otimes}$ & $(X \otimes Y) \otimes Z \to X \otimes (Y \otimes Z)$ & $(x \otimes y) \otimes z \mapsto x \otimes (y \otimes z)$ \\
        \hline
        \multicolumn{3}{c}{\textit{Functions about \(\&\)}} \\
        \hline
        $\textrm{diagonal}$ & $X \to X \& X$ & $x \mapsto x \& x$ \\
        $\textrm{proj}_{1, \&}$ & $X \& Y \to X$ & $x \& y \mapsto x$ \\
        $\textrm{proj}_{2, \&}$ & $X \& Y \to Y$ & $x \& y \mapsto y$ \\
        \hline
        \multicolumn{3}{c}{\textit{Functions about \(+\)}} \\
        \hline
        $\textrm{coswap}$ & $X + Y \to Y + X$ & $\left\{\begin{tabular}{l}
        $\textrm{left}(x) \mapsto \textrm{right}(x)$\\
        $\textrm{right}(y) \mapsto \textrm{left}(y)$
        \end{tabular}\right.$ \\
        $\textrm{coproj}_1$ & $X \to X + Y$ & $x \mapsto \text{left}(x)$ \\
        $\textrm{coproj}_2$ & $Y \to X + Y$ & $y \mapsto \text{right}(y)$ \\
        $\textrm{coassoc}$ & $(X + Y) + Z \to X + (Y + Z)$ & $\left\{
        \begin{tabular}{l}
        $\text{left}(\text{left}(x)) \mapsto \text{left}(x)$\\
        $\text{left}(\text{right}(y)) \mapsto \text{right}(\text{left}(y))$\\
        $\text{right}(z)\mapsto \text{right}(\text{right}(z))$
        \end{tabular}\right.$ \\
        $\textrm{codiagonal}$ & $X + X \to X$ & $\left\{\begin{tabular}{l}
        $\text{left}(x) \mapsto x$\\
        $\text{right}(x) \mapsto x$
        \end{tabular}\right.$ \\
        \hline
        \multicolumn{3}{c}{\textit{Distributivities}} \\
        \hline
        $\textrm{distr}_{\otimes, +}$ & $X \otimes (Y + Z) \to (X \otimes Y) + (X \otimes Z)$ & $\left\{\begin{tabular}{l}
            $x \otimes (\text{left}(y)) \mapsto \text{left}(x \otimes y)$\\
            $x \otimes (\text{right}(z)) \mapsto \text{right}(x \otimes z)$
        \end{tabular}\right.$\\
        $\textrm{distr}_{\otimes, \&}$ & $X \otimes (Y \& Z) \to (X \otimes Y) \& (X \otimes Z)$ & $x \otimes (y \& z) \mapsto (x \otimes y) \& (x \otimes z)$ \\
        $\textrm{distr}_{+, \&}$ & $X + (Y \& Z) \to (X \& Y) + (X \& Z)$ & $\left\{\begin{tabular}{l}
        $x \& \text{left}(y) \mapsto \text{left}(x \& y)$\\
        $x \& \text{right}(z) \mapsto \text{right}(x \& z)$
        \end{tabular}\right.$ \\
        \hline
    \end{tabular}
    \caption{The above table shows an infinite family of morphisms, which is indexed by types $X,Y,Z$.}
    \label{fig:prime-morphisms}
\end{table}


% The prime functions can then be put together using combinators. The main combinator is function composition; this will ensure that the single-use functions form a category. The remaining combinators are functoriality of the three type constructors $+$, $\otimes$ and $\&$. More specifically, the combinator for $\otimes$ works as follows. It takes two single-use functions, $f_1$ and $f_2$, with types $X_1 \to Y_1$ and $X_2 \to Y_2$ respectively, and returns a new function $f_1 \otimes f_2$ of type $X_1 \otimes X_2 \to Y_1 \otimes Y_2$, which is defined in the natural way: $x_1 \otimes x_2 \mapsto f_1(x_1) \otimes f_2(x_2)$.  The combinators for $+$ and $\&$ are defined in an analagous way. This completes the definition of the single-use functions, which is  summarised below.
% \begin{table}[h!]
%     \centering
%     \begin{tabular}{lll}
%         \hline
%         \textbf{Function} & \textbf{Type} & \textbf{Definition} \\
%         \hline
%         \multicolumn{3}{c}{\textit{Functions about Atoms}} \\
%         \hline
%         $\textrm{eq}$ & $\atoms \otimes \atoms \to 1 + 1$ & $a, b \mapsto \text{if } a = b \text{ then true else false}$ \\
%         $\textrm{const}_a$ & $1 \to \atoms$ & $x \mapsto a$ \\
%         $\textrm{id}$ & $\atoms \to \atoms$ & $x \mapsto x$ \\
%         \hline
%         \multicolumn{3}{c}{\textit{Functions about \(\otimes\)}} \\
%         \hline
%         $\textrm{swap}_{\otimes}$ & $X \otimes Y \to Y \otimes X$ & $x \otimes y \mapsto y \otimes x$ \\
%         $\textrm{proj}_{1, \otimes}$ & $X \otimes Y \to X$ & $x \otimes y \mapsto x$ \\
%         $\textrm{proj}_{2, \otimes}$ & $X \otimes Y \to Y$ & $x \otimes y \mapsto y$ \\
%         $\textrm{rightI}_{\otimes}$ & $ X \to X \otimes 1$ & $x \mapsto x \otimes ()$ \\
%         $\textrm{assoc}_{\otimes}$ & $(X \otimes Y) \otimes Z \to X \otimes (Y \otimes Z)$ & $(x \otimes y) \otimes z \mapsto x \otimes (y \otimes z)$ \\
%         \hline
%         \multicolumn{3}{c}{\textit{Functions about \(\&\)}} \\
%         \hline
%         $\textrm{diagonal}$ & $X \to X \& X$ & $x \mapsto x \& x$ \\
%         $\textrm{proj}_{1, \&}$ & $X \& Y \to X$ & $x \& y \mapsto x$ \\
%         $\textrm{proj}_{2, \&}$ & $X \& Y \to Y$ & $x \& y \mapsto y$ \\
%         \hline
%         \multicolumn{3}{c}{\textit{Functions about \(+\)}} \\
%         \hline
%         $\textrm{coswap}$ & $X + Y \to Y + X$ & $\left\{\substack{
%         \textrm{left}(x) \mapsto \textrm{right}(x)\\
%         \textrm{right}(y) \mapsto \textrm{left}(y)
%         }\right.$\\
%         $\textrm{coproj}_1$ & $X \to X + Y$ & $x \mapsto \text{left}(x)$ \\
%         $\textrm{coproj}_2$ & $Y \to X + Y$ & $y \mapsto \text{right}(y)$ \\
%         $\textrm{coassoc}$ & $(X + Y) + Z \to X + (Y + Z)$ & \\
%         $\textrm{codiagonal}$ & $X + X \to X$ &  \\
%         \hline
%         \multicolumn{3}{c}{\textit{Distributivities}} \\
%         \hline
%         $\textrm{distr}_{\otimes, +}$ & $X \otimes (Y + Z) \to (X \otimes Y) + (X \otimes Z)$ & \\
%         $\textrm{distr}_{\otimes, \&}$ & $X \otimes (Y \& Z) \to (X \otimes Y) \& (X \otimes Z)$ & $x \otimes (y \& z) \mapsto (x \otimes y) \& (x \otimes z)$ \\
%         $\textrm{distr}_{+, \&}$ & $X + (Y \& Z) \to (X + Y) \& (X + Z)$ &  \\
%         \hline
%     \end{tabular}
%     \caption{The above table shows an infinite family of morphisms, which is indexed by types $X,Y,Z$.}
%     \label{fig:prime-morphisms}
% \end{table}


% \begin{figure}
%     \begin{align*}
%         \begin{array}{lll}
%             \textbf{Function} & \textbf{Type} & \textbf{Definition} \\
%             \hline
%             \multicolumn{3}{c}{\textit{Functions about Atoms}} \\
%             \hline
%             eq & Atom \to Atom \to Bool & a, b \mapsto \text{if } a = b \text{ then true else false} \\
%             const\_a & X \to Atom & x \mapsto a \\
%             \hline
%             \multicolumn{3}{c}{\textit{Functions about } \oplus} \\
%             \hline
%             identity & X \to X & x \mapsto x \\
%             swap\_\oplus & X \oplus Y \to Y \oplus X & x \oplus y \mapsto y \oplus x \\
%             \hline
%             \multicolumn{3}{c}{\textit{Functions about } \&} \\
%             \hline
%             diagonal & X \to X \& X & x \mapsto x \& x \\
%             proj\_1 & X \& Y \to X & x \& y \mapsto x \\
%             proj\_2 & X \& Y \to Y & x \& y \mapsto y \\
%             \hline
%             \multicolumn{3}{c}{\textit{Functions about } +} \\
%             \hline
%             inl & X \to X + Y & x \mapsto \text{left}(x) \\
%             inr & Y \to X + Y & y \mapsto \text{right}(y) \\
%             codiagonal & X + X \to X & x + x \mapsto x \\
%             \hline
%             \multicolumn{3}{c}{\textit{Distributivities}} \\
%             \hline
%             distribute & X \otimes (Y + Z) \to (X \otimes Y) + (X \otimes Z) & x \otimes (y + z) \mapsto (x \otimes y) + (x \otimes z) \\
%             factor & (X + Y) \otimes Z \to (X \otimes Z) + (Y \otimes Z) & (x + y) \otimes z \mapsto (x \otimes z) + (y \otimes z) \\
%         \end{array}
%     \end{align*}
%     \caption{\label{fig:prime-morphisms} The above table shows an infinite family of morphisms, which is indexed by  types $X,Y,Z$.}
% \end{figure}


   


\begin{definition}[Single-use functions] The class of single-use functions is the least class of functions with the following properties:
        \begin{enumerate}
            \item It contains the functions from Figure~\ref{fig:prime-morphisms}, all constant functions\footnote{By this we mean one constant function $1 \to \atoms$ for every atom. Using these constant functions, and the remaining functions and combinators in the system, one can derive every constant function $1 \to X$ for every type $X$.}, and the equality test $\atoms \otimes \atoms \to 1+1$.
            \item It is closed under composition, as well as under combining functions using  $+$, $\otimes$ and $\&$. 
        \end{enumerate}
\end{definition}

By definition, for every types $X$ and $Y$, every single-use function of type $X \to Y$ is a certain function from set $\sem X$ to the set $\sem Y$. One can easily see that this function is  finitely supported, since the prime functions are finitely supported and the combinators preserve this property.  Therefore, one can think of the single-use functions of type $X \to Y$ as being a subset of the set of all finitely supported functions from $\sem X$ to $\sem Y$. This subset is strict: as we will see, the space of single-use functions will be orbit-finite, unlike the space of all finitely supported functions. If we think of the single-use functions as a category, as we will be, then this category admits a faithful functor to the category of polynomial orbit-finite sets with finitely suported functions as morphisms.




% As this example shows, the definition of single-use functions in terms of prime functions and combinators can be a bit cumbersome from the point of view of a programmer. Also, 

Since the single-use functions are closed under composition by definition, one can think of them as being a category. 


\begin{definition}[Category of single-use sets]\label{def:single-use-category}
    The category of single-use sets is:
    \begin{enumerate}
        \item The objects are types, as per Definition~\ref{def:datatypes}.
        \item Morphisms between types $X$ and $Y$ are a single-use functions of type $\sem X \to \sem Y$.
    \end{enumerate}
\end{definition}

% We use the name \emph{single-use morphisms} for morphisms of the above category. A single-use morphism is the same as a single-use function, together with the information about the types between which it is a morphism. For example, the idenitity function on $\sem{\atoms \& \atoms}$ is the same as the identity function on $\sem{\atoms \otimes \atoms}$, because the two underlying sets are the same, but the corresponding morphisms are different. 
% From now on, instead of talking about single-use functions of type $\sem X \to \sem Y$, we will speak about single-use morphisms of type $X \to Y$.



 
The main technical result of this paper is that the category of single-use sets has function spaces, as stated in the following theorem.  The appropriate product will be $\otimes$, and not $\&$. Since the Cartesian product in our category will be $\&$ and not $\otimes$, this means that the result we are targetting is symmetric monoidal closed with respect to $\otimes$, and not Cartesian closed. (The same situation happend for vector spaces.)  Our theorem stops a bit short of saying that the category is monoidal closed, since several different elements of the function space might represent the same function. This non-uniqueness of representation can be overcome  by quotienting the function space  by an equivalence relation that identifies two elements if they represent the same single-use function; this idea will be developed  in Section~\ref{sec:quotient-category}. For now, we stick with non-uniqueness of representation, and we state the theorem as follows.

\begin{theorem}\label{thm:single-use-closed}
    Let $V$ and $W$ be types. There exists a type, denoted by  $\funspace V W$, and a single-use function 
    \begin{align*}
    eval : (\funspace V W) \otimes V \to  W
    \end{align*}
    with the following property. For every single-use function
    \begin{align*}
    f : {X \otimes V} \to  W
    \end{align*}
    there is a (not necessarily unique) single-use function 
    \begin{align*}
    h :  X \to (\funspace V W)
    \end{align*}
    such that the following diagram commutes in the category of single-use sets:
    \[
    \begin{tikzcd}
    X \otimes V 
    \arrow[r,"h \otimes id"]
    \arrow[dr,"f"']
    &
    (\funspace V W) \otimes V
    \arrow[d,"eval"] \\
    &
    W
    \end{tikzcd}
    \]
\end{theorem}

The above theorem is the main technical contribution of this paper, and its proof is presented in Section~\ref{sec:game-semantics}. The difficulty in the proof is finding a representation of functions which is rich enough to capture all functions, but simple enough to be described by a finite type (in particular, the corresponding set will be orbit-finite). The main problem is with compositions, i.e.~a function of type $X \to Y$ could be defined as a composition of two functions of types $X \to Z$ and $Z \to Y$. In principle, the intermediate type $Z$ could  be very large, and the number of such compositions could also be large. (Recall that in Example~\ref{ex:six-compositions}, we needed to compose six functions to get a relatively straightforward operation.) Our solution is to use game semantics. We describe single-use functions using strategies in certain games. One can think of these strategies as describing single-use programs in a certain normal form; this normal form will be restricted enough to ensure that the function space can be described using a type, in particular it will be orbit-finite. 








\subsection{The quotient category}
\label{sec:quotient-category}
A drawback of Theorem~\ref{thm:single-use-closed} is that the function space $\funspace V W$ can contain several different representations of the same function; this will mean that Currying is not unique. To overcome this issue, we use a simple quotient constrution. 
% Define a \emph{partial equivalence relation} to be an relation that is symmetric and transitive, but not necessarily reflexive.  This is the same as (complete) equivalence relation on some subset. We will use a partial equivalence on the function space $X \Rightarrow Y$ to: (1)
%  remove objects that do not represent any function; (2) identify two objects if they represent the same function. After such a quotient, the function space will have unique representations for functions. 




\begin{definition}
    The \emph{quotiented single-use category} is: 
    \begin{itemize}
    \item Objects are pairs consisting of a type $X$ and an equivariant  equivalence relation $\sim$ on $\sem X$.
    \item Morphisms between objects $(X,\sim_X)$ and $(Y,\sim_Y)$ are single-use functions of type $X \to Y$  which respect the equivalences, i.e.~equivalent inputs are mapped to equivalent outputs.
    \end{itemize}
\end{definition}

The quotiented single-use category is also equipped with a tensor product $\otimes$ on its objects.
\begin{theorem}
    The quotiented single-use category, equipped with the tensor product $\otimes$, is a monoidal closed category, i.e.~it satisfies the conclusions of Theorem~\ref{thm:single-use-closed}, but futhermore the morphism $h$ is unique.
\end{theorem}

